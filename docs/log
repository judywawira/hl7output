obstacles

availability of something to start from

made a module but couldn't use hapi 1.2

- JETTY STARTUP
WARN - ModuleFactory.startModuleInternal(668) |2012-06-04 14:18:36,322| Error while trying to start module: hl7output
org.openmrs.module.ModuleException: Unable to update data model using liquibase.xml. Module: HL7 Output Module
	at org.openmrs.module.ModuleFactory.runLiquibase(ModuleFactory.java:840)
	at org.openmrs.module.ModuleFactory.startModuleInternal(ModuleFactory.java:612)
	at org.openmrs.api.context.Daemon$1.run(Daemon.java:70)
Caused by: liquibase.exception.ChangeLogParseException: java.lang.ClassCastException: org.apache.xerces.parsers.XIncludeAwareParserConfiguration cannot be cast to org.apache.xerces.xni.parser.XMLParserConfiguration
	at liquibase.parser.core.xml.XMLChangeLogSAXParser.parse(XMLChangeLogSAXParser.java:134)
	at liquibase.Liquibase.listUnrunChangeSets(Liquibase.java:581)
	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:208)
	at org.openmrs.module.ModuleFactory.runLiquibase(ModuleFactory.java:830)
	... 2 more
Caused by: java.lang.ClassCastException: org.apache.xerces.parsers.XIncludeAwareParserConfiguration cannot be cast to org.apache.xerces.xni.parser.XMLParserConfiguration
	at org.apache.xerces.parsers.SAXParser.<init>(Unknown Source)
	at org.apache.xerces.parsers.SAXParser.<init>(Unknown Source)
	at org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.<init>(Unknown Source)
	at org.apache.xerces.jaxp.SAXParserImpl.<init>(Unknown Source)
	at org.apache.xerces.jaxp.SAXParserFactoryImpl.newSAXParser(Unknown Source)
	at liquibase.parser.core.xml.XMLChangeLogSAXParser.parse(XMLChangeLogSAXParser.java:61)
	... 5 more

IF I MAKE XERCES 'PROVIDED'
- JETTY STARTUP
WARN - ModuleFactory.startModuleInternal(668) |2012-06-04 14:47:25,030| Error while trying to start module: logic
org.openmrs.module.ModuleException: Module requires at least version 1.7.2.17710,  Current code version is only ${parsedVersion.majorVersion}.${parsedVersion.m
	at org.openmrs.module.ModuleUtil.checkRequiredVersion(ModuleUtil.java:329)
	at org.openmrs.module.ModuleFactory.startModuleInternal(ModuleFactory.java:525)
	at org.openmrs.api.context.Daemon$1.run(Daemon.java:70)
INFO - LoggingAdvice.invoke(117) |2012-06-04 14:47:25,349| In method AlertService.saveAlert. Arguments: Alert=Alert: #null, 
INFO - LoggingAdvice.invoke(142) |2012-06-04 14:47:25,382| Exiting method saveAlert
WARN - ModuleFactory.stopModule(895) |2012-06-04 14:47:25,448| Unable to call module's Activator.willStop() method
org.openmrs.module.ModuleException: The classloader is null Module: logic
	at org.openmrs.module.Module.getModuleActivator(Module.java:181)
	at org.openmrs.module.ModuleFactory.stopModule(ModuleFactory.java:891)
	at org.openmrs.module.ModuleFactory.startModuleInternal(ModuleFactory.java:679)
	at org.openmrs.api.context.Daemon$1.run(Daemon.java:70)

SO I REMOVED THE CHECK SINCE I THINK IT'S BOGUS
- MODULE STARTUP
WARN - ModuleFactory.startModuleInternal(668) |2012-06-04 14:58:33,446| Error while trying to start module: hl7output
org.openmrs.module.ModuleException: Unable to update data model using liquibase.xml. Module: HL7 Output Module
	at org.openmrs.module.ModuleFactory.runLiquibase(ModuleFactory.java:840)
	at org.openmrs.module.ModuleFactory.startModuleInternal(ModuleFactory.java:612)
	at org.openmrs.api.context.Daemon$1.run(Daemon.java:70)
Caused by: liquibase.exception.ChangeLogParseException: java.lang.ClassCastException: org.apache.xerces.parsers.XIncludeAwareParserConfiguration cannot be cast to org.apache.xerces.xni.parser.XMLParserConfiguration
	at liquibase.parser.core.xml.XMLChangeLogSAXParser.parse(XMLChangeLogSAXParser.java:134)
	at liquibase.Liquibase.listUnrunChangeSets(Liquibase.java:581)
	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:208)
	at org.openmrs.module.ModuleFactory.runLiquibase(ModuleFactory.java:830)
	... 2 more
Caused by: java.lang.ClassCastException: org.apache.xerces.parsers.XIncludeAwareParserConfiguration cannot be cast to org.apache.xerces.xni.parser.XMLParserConfiguration
	at org.apache.xerces.parsers.SAXParser.<init>(Unknown Source)
	at org.apache.xerces.parsers.SAXParser.<init>(Unknown Source)
	at org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.<init>(Unknown Source)
	at org.apache.xerces.jaxp.SAXParserImpl.<init>(Unknown Source)
	at org.apache.xerces.jaxp.SAXParserFactoryImpl.newSAXParser(Unknown Source)
	at liquibase.parser.core.xml.XMLChangeLogSAXParser.parse(XMLChangeLogSAXParser.java:61)
	... 5 more

SO I MAKE IT 'PROVIDED' FOR THE MODULE AS WELL
- MODULE STARTUP
- same problem

used a module but couldn't use hapi 1.2

tried hapi 0.5 but
- couldn't generate custom classes
- tried hacking them in but

hapi 1.2 parser doesn't do custom xml parsing (bug)


it turns out my module was depending on openmrs v1.8.3 that had different libraries (hapi, xerces, + whatever)
FIXED!!! when i updated to 1.10.0-SNAPSHOT and commented out bogus exception that happens for loading modules on a snapshot version of openmrs


checked out the source for 1.8.4-SNAPSHOT
merged RHEASHRadapter into hl7output module and depend on 1.8.4-SNAPSHOT
openmrs pom changed to hapi-structures-v25 release 1.2 (modified by me for bug)
wouldn't migrate from 1.8.3 data though...got a "Field 'ORDEREXECUTED' doesn't have a default value" error


